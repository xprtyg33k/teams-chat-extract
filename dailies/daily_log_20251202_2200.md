# Daily Log – 2025-12-02 22:00

## Bug Fix: NoneType AttributeError in Message Processing

### Issue Identified
When exporting chat messages, the script crashed with:
```
AttributeError: 'NoneType' object has no attribute 'get'
```

This occurred in `process_message()` at line 749 when processing messages from the Microsoft Graph API.

### Root Cause
The `process_message()` function extracted sender information like this:
```python
user_info = from_info.get("user", {}) if from_info else {}
```

However, `.get("user")` can return `None` explicitly (when the key exists but has a `None` value), which is different from the key not existing. The code then tried to call `.get()` on `None`, causing the AttributeError.

This occurred when some messages in the chat had `"from": {"user": null}` in the Graph API response.

### Solution Implemented
Modified `teams_chat_export.py` lines 740-745 to:
1. Extract `user_info` without a default value
2. Check if `user_info` is actually a dict using `isinstance()`
3. Convert any non-dict value (including `None`) to an empty dict

```python
user_info = from_info.get("user") if from_info else None
if not isinstance(user_info, dict):
    user_info = {}
```

This ensures `user_info` is always a dict before calling `.get()` on it.

### Testing
✅ Re-ran the failing export command with the same chat and date range  
✅ Successfully exported 37 messages without errors  
✅ Output file created: `C:\Files\Artifacts\transcript_incident-ITSD-40915.txt`

### Files Modified
- `teams_chat_export.py` (lines 740-745)

### Impact
- Fixes crash when exporting chats with messages that have null sender information
- Gracefully handles edge cases in Graph API responses
- No breaking changes to existing functionality

